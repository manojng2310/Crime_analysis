--Which crime is maximum in each District?

CREATE VIEW query3 AS 
(SELECT DISTRICT, OFFENSE_CODE_GROUP, COUNT(INCIDENT_NUMBER) AS NUMBER_OF_INCIDENTS
FROM dbo.CrimeTable
GROUP BY DISTRICT,OFFENSE_CODE_GROUP
)

CREATE VIEW query3_2 AS (
SELECT DISTRICT,MAX(NUMBER_OF_INCIDENTS) AS MAX_INCIDENTS FROM
(SELECT DISTRICT, COUNT(INCIDENT_NUMBER) AS NUMBER_OF_INCIDENTS
FROM dbo.CrimeTable
GROUP BY DISTRICT,OFFENSE_CODE_GROUP
) P
GROUP BY DISTRICT)

SELECT Q1.DISTRICT,Q1.OFFENSE_CODE_GROUP,Q2.MAX_INCIDENTS FROM query3 Q1, query3_2 Q2
WHERE Q1.DISTRICT = Q2.DISTRICT AND Q1.NUMBER_OF_INCIDENTS = Q2.MAX_INCIDENTS
ORDER BY DISTRICT


--Dangerous hour per month? 

CREATE VIEW query4 AS (
SELECT MONTH,MAX(NUMBER_OF_INCIDENTS) AS MAXIMUM_INCIDENTS FROM (
SELECT HOUR,MONTH,COUNT(INCIDENT_NUMBER) AS NUMBER_OF_INCIDENTS
FROM dbo.CrimeTable
GROUP BY HOUR,MONTH
) P GROUP BY MONTH )

CREATE VIEW query4_2 AS
SELECT HOUR,MONTH,COUNT(INCIDENT_NUMBER) AS NUMBER_OF_INCIDENTS
FROM dbo.CrimeTable
GROUP BY HOUR,MONTH

SELECT Q2.HOUR, Q2.MONTH, Q1.MAXIMUM_INCIDENTS FROM query4 Q1, query4_2 Q2
WHERE Q1.MONTH = Q2.MONTH AND Q1.MAXIMUM_INCIDENTS = Q2.NUMBER_OF_INCIDENTS
ORDER BY MONTH


--Month in which least crime is noted in a year?

CREATE VIEW query1 AS 
(SELECT year, month , COUNT(INCIDENT_NUMBER) AS NUMBER_OF_INCIDENTS
FROM dbo.Crime_final
GROUP BY year,month
)

CREATE VIEW query2 AS (
SELECT year , min(NUMBER_OF_INCIDENTS) AS LEAST_INCIDENTS FROM
(SELECT year , COUNT(INCIDENT_NUMBER) AS NUMBER_OF_INCIDENTS
FROM dbo.Crime_final
GROUP BY year,month
) P
GROUP BY year)

SELECT Q1.year,Q1.month,Q2.LEAST_INCIDENTS FROM query1 Q1, query2 Q2
WHERE Q1.year = Q2.year AND Q1.NUMBER_OF_INCIDENTS = Q2.LEAST_INCIDENTS
ORDER BY year


--Safest District in Boston? 

SELECT TOP(1) DISTRICT, count(INCIDENT_NUMBER) as number_of_incident 
FROM dbo.crime_clean 
GROUP BY DISTRICT 
ORDER BY COUNT(INCIDENT_NUMBER);


--Number of crimes with type of crime in each year. 

create procedure crimess_in_a_year @year smallint
as
select year , OFFENSE_CODE_GROUP, count(INCIDENT_NUMBER) as number_of_incident
from crime_final
where year= @year
group by year, OFFENSE_CODE_GROUP
order by number_of_incident

exec crimess_in_a_year @year = year
